<%- include('../partials/html-head') %>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Karla:wght@519&family=Source+Sans+Pro:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<link rel="stylesheet" href="/stylesheets/details.css">

<%- include('../partials/nav') %>
 
<container>
  <table>
    <thead>
      <tr>
        <th>Name:</th>
        <th>Race:</th>
        <th>Class:</th>
        <th>Age:</th>
        <th>Alignment:</th>
        <th>Background:</th>
        <th>Personality Traits:</th>
        <th>Ideals:</th>
        <th>Bonds:</th>
        <th>Flaws:</th>
        <th>Skills:</th>
        <th>Details</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><%= characters.name %></td>
        <td><%= characters.race %></td>
        <td><%= characters.class %></td>
        <td><%= characters.age %></td>
        <td><%= characters.alignment %></td>
        <td><%= characters.background %></td>
        <td><%= characters.ptone %>,<%= characters.pttwo %></td>
        <td><%= characters.ideals %></td>
        <td><%= characters.bonds %></td>
        <td><%= characters.flaws %></td>
        <td><%= characters.skills %></td>
        <td><%- characters.descript %></td>
      </tr>
    </tbody>
  </table>
          <% if (characters.owner.equals(user?.profile._id)) { %>
            <form action="/characters/<%= characters._id %>/edit" method="GET">
              <button class="btn" type="submit">Edit character</button>
            </form>
            <form action="/characters/<%= characters._id %>?_method=DELETE" method="POST">
              <button type="submit">Delete</button>
            </form>
            <% } %>



            <h2>Comments</h2>
            <form 
              id="add-comment-form"
              action="/characters/<%= characters._id %>/comments"
              method="POST"
            >
          
            
              <label for="content-textarea">Comment:</label>
              <textarea name="content" id="content-textarea"></textarea>
              <label for="rated-select">Rate:</label>
              <select name="rated" id="rated-select">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5" selected>5</option>
              </select>
              <button type="submit">Add Comment</button>
            </form>
          
          
          
            <% if (characters.comments.length) { %>
              <table>
                <thead>
                  <tr>
                    <th>Avatar</th>
                    <th>User</th>
                    <th>Date</th>
                    <th>Comment</th>
                    <th>Rated</th>
                  </tr>
                </thead>
                
                <tbody>
                  <% let total = 0 %> 
                  <% characters.comments.forEach(function(comment){ %>
                    <% total += comment.rated %> 
                    <tr>
                      <td><img src="<%= comment.owner.avatar %>"></td>
                      <td><%= comment.owner.name %></td>
                      <td><%= comment.createdAt.toLocaleDateString() %> </td>
                      <td><%= comment.content %></td>
                      <td><%= comment.rated %> </td>
                    </tr>
                  <% }) %>
                  <tr>
                    <td colspan="2"></td>
                    <td>
                      <strong><%= averageCommentScore %></strong>
                    </td>
                  </tr>
                </tbody>
              </table>
            <% } else { %>
              <h3>No Comments Yet</h3>
            <% } %>
</container>



<%- include('../partials/footer') %>
