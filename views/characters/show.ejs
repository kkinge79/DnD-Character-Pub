<%- include('../partials/html-head') %>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Karla:wght@519&family=Source+Sans+Pro:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<link rel="stylesheet" href="/stylesheets/details.css">

<%- include('../partials/nav') %>

<container>
      <div id="info">
        <h2>Name</h2>
        <p><%= characters.name %></p>
        <h2>Race</h2>
        <p><%= characters.race %></p>
        <h2>Class</h2>
        <p><%= characters.class %></p>
        <h2>Age</h2>
        <p><%= characters.age %></p>
        <h2>Alignment</h2>
        <p><%= characters.alignment %></p>
        <h2>Background</h2>
        <p><%= characters.background %></p>
        <h2>Personality Traits</h2>
        <p><%= characters.ptone %>,<%= characters.pttwo %></p>
        <h2>Ideals</h2>
        <p><%= characters.ideals %></p>
        <h2>Bonds</h2>
        <p><%= characters.bonds %></p>
        <h2>Flaws</h2>
        <p><%= characters.flaws %></p>
        <h2>Skills</h2>
        <p><%= characters.skills %></p>
        <h2>Details</h2>
        <p><%= characters.descript %></p>
      </div>


          <% if (characters.owner.equals(user?.profile._id)) { %>
            <form action="/characters/<%= characters._id %>/edit" method="GET">
              <button class="btn btn-primary" type="submit">Edit character</button>
            </form>
            <form action="/characters/<%= characters._id %>?_method=DELETE" method="POST">
              <button class="btn btn-primary" type="submit">Delete</button>
            </form>
            <% } %>



            <h2>Comments</h2>
            <form 
              id="add-comment-form"
              action="/characters/<%= characters._id %>/comments"
              method="POST"
            >
          
            
              <label for="content-textarea">Comment:</label>
              <textarea name="content" id="content-textarea"></textarea>
              <label for="rated-select">Rate:</label>
              <select name="rated" id="rated-select">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5" selected>5</option>
              </select>
              <button type="submit" class="btn btn-primary">Add Comment</button>
            </form>
          
          
          
            <% if (characters.comments.length) { %>
              <table>
                <thead>
                  <tr>
                    <th>Avatar</th>
                    <th>User</th>
                    <th>Date</th>
                    <th>Comment</th>
                    <th>Rated</th>
                  </tr>
                </thead>
                
                <tbody>
                  <% let total = 0 %> 
                  <% characters.comments.forEach(function(comment){ %>
                    <% total += comment.rated %> 
                    <tr>
                      <td><%= comment.owner.name %></td>
                      <td><img src="<%= comment.owner.avatar %>"></td>
                      <td><%= comment.createdAt.toLocaleDateString() %> </td>
                      <td><%= comment.content %></td>
                      <td><%= comment.rated %> </td>
                    </tr>
                  <% }) %>
                  <tr>
                    <td colspan="2"></td>
                    <td>
                      <strong><%= averageCommentScore %></strong>
                    </td>
                  </tr>
                </tbody>
              </table>
            <% } else { %>
              <h3>No Comments Yet</h3>
            <% } %>
</container>



<%- include('../partials/footer') %>
